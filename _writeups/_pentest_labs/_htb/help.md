[**< back**](/README.md)

# HTB - Help

![help_banner](/_storage/_img/_pentest_labs/_htb/help/help.gif)  
**Machine**: Help  
**Author**: Nika Kharebava  

## Information Gathering  
### NMap  
Initial enumeration using Nmap :mag:  
`nmap -sV -sC -T5 -Pn 10.129.230.145 -oA help`  

![initial_nmap_scan](/_storage/_img/_pentest_labs/_htb/help/initial_nmap_scan.png)  


### Surfing web :spider_web:
Lets just take a look and figure out what it's running and where...
There's an interesting message on port 3000 which is running some kind of web...
![surfing_3000_port](/_storage/_img/_pentest_labs/_htb/help/surfing_3000_port.png)  
Noted... will get back to it later...

Checking out the 80 port web only to see that it is returning an apache help page...
![apache_help_page](/_storage/_img/_pentest_labs/_htb/help/apache_help_page.png)

so there was a hint about query...  
If we take a look at the request and the response in burp... there it is...  
![request_in_burp](/_storage/_img/_pentest_labs/_htb/help/request_in_burp.png)  
Server is running graphql, maybe we can find something interesting...  

### Enumerating GraphQL :mag:
It allowes any user to just send a request and dump data from graphql, we can request for query types using just a curl...  
![graphql_query_types](/_storage/_img/_pentest_labs/_htb/help/graphql_query_types.png)  
```
curl 'http://10.129.230.145:3000/graphql' -H 'Content-Type: application/json' -H 'Accept: application/json' --compressed --data-binary '{"query":"{  __schema{  queryType {  fields{  name, description  }  }  } }"}'
```

![querying_users](/_storage/_img/_pentest_labs/_htb/help/querying_users.png)  
We can simply query for users and passwords in this db...
```
curl 'http://10.129.230.145:3000/graphql' -H 'Content-Type: application/json' -H 'Accept: application/json' --co
{"data":{"user":{"username":"helpme@helpme.com","password":"5d3c93182bb20f07b994a7f617e99cff"}}} 
```

The MD5 hash is crackable... 
![md5_cracked](/_storage/_img/_pentest_labs/_htb/help/cracked_hash_from_graphql.png)  
Now we have a username and a password, probably for some service hidden in the website or any other place... (`helpme@helpme.com`:`godhelpmeplz`)

### Enumerating endpoints :mag:

After scanning http://help.htb domain with gobuster we can see that there are two extra endpoints are available
![gobuster_res](/_storage/_img/_pentest_labs/_htb/help/gobuster_res.png)

`javascript` does not give us anything, while `support` redirects us to helpdeskz page... 

![helpdeskz](/_storage/_img/_pentest_labs/_htb/help/helpdeskz.png)  

where after trying to login with credentials we've harvested, we are greeted with a dashboard page of helpdeskz...  
![helpdeskz_dash](/_storage/_img/_pentest_labs/_htb/help/helpdeskz_dashboard.png)  

This is what searchsploit suggests...  
![searchsploit](/_storage/_img/_pentest_labs/_htb/help/searchsploit.png)  

## Exploitation

### Exploiting file upload vulnerability  

helpdeskz is vulnerable to authenticated file upload, we can upload a php file, which results in an error code saying file type not allowed, but the file is still there and the exploit is exactly for the purpose of finding the exact path after uploading the shell file...  
![uploading_shell](/_storage/_img/_pentest_labs/_htb/help/uploading_shell.png)  

Next we run the python script from searchsploit, allowing us to find the exact path after upload...  
![upload_python_exploit_search](/_storage/_img/_pentest_labs/_htb/help/upload_python_exploit_search.png)  

And now we have the shell as `help` user  
 ![shell_as_help_user](/_storage/_img/_pentest_labs/_htb/help/shell_as_help.png)  
 ![shell_as_help_user](/_storage/_img/_pentest_labs/_htb/help/shell.png)  

## Privilege Escalation  

Since we have only gained access to `help` user, we have to somehow gain root privileges to fully compromise the machine  

Lets first check the exact system version  
![uname_a](/_storage/_img/_pentest_labs/_htb/help/uname_a.png)  

After a bit of searching... :mag:  
![searchsploit](/_storage/_img/_pentest_labs/_htb/help/searchsploit_privilege_escalation.png)  
I'm using this one right here...  
`Linux Kernel < 4.4.0-116 (Ubuntu 16.04.4) - Local Privilege Escalation           | linux/local/44298.c`

Delivering and compiling exploit :microbe:  
![delivery_and_compilation](/_storage/_img/_pentest_labs/_htb/help/delivery_and_compilation.png)  

And that's it, we are root :penguin:  
![escalated](/_storage/_img/_pentest_labs/_htb/help/escalated.png)  

![mission_accomplished](/_storage/_img/_pentest_labs/_htb/help/mission_accomplished.gif)