[**< back**](/README.md)

# HTB - Ready

![ready_banner](/_storage/_img/_pentest_labs/_htb/ready/ready_banner.jpg)  
**Machine**: Ready  
**Author**: Nika Kharebava  

## Information Gathering  
### NMap  
Initial enumeration using Nmap :mag:  
`nmap -sV -sC -T5 -Pn 10.129.227.132`  
![initial_nmap_scan](/_storage/_img/_pentest_labs/_htb/ready/initial_nmap_scan.png)  
Quick additional port discovery
`rustscan -a 10.129.227.132 --range 1-65000 `  

![rustscan_port_discovery](/_storage/_img/_pentest_labs/_htb/ready/rustscan_port_discovery.png)  

5080 Port seems to be interesting
![5080_port](/_storage/_img/_pentest_labs/_htb/ready/5080_port.png)  

It is running a gitlab instance on port 5080  
![gitlab_discovered](/_storage/_img/_pentest_labs/_htb/ready/gitlab_discovered.png)  

I've registred on gitlab and tried exploring if any projects were available.  
![discovering_gitlab](/_storage/_img/_pentest_labs/_htb/ready/discovering_gitlab.png)  

and I just cloned the repo trying to discover anything interesting in it...  
![git_clone](/_storage/_img/_pentest_labs/_htb/ready/git_clone.png)  

Doing some quick research about branches, changes etc...  
![discovering_repo](/_storage/_img/_pentest_labs/_htb/ready/discovering_repo.png)  

This one might be useful later...  

![drupal_db_creds_discovered](/_storage/_img/_pentest_labs/_htb/ready/drupal_db_creds.png)  

```
$databases = array (
  'default' => 
  array (
    'default' => 
    array (
      'database' => 'drupal',
      'username' => 'drupaluser',
      'password' => '%%cHzhNC=k9yYN!T',
      'host' => 'localhost',
      'port' => '',
      'driver' => 'mysql',
      'prefix' => '',
    ),
  ),
);
```

also this one's interesting too  

![test_user_creation](/_storage/_img/_pentest_labs/_htb/ready/test_user_creation.png)  

```
// Create six users
for ($i = 0; $i < 6; $i++) {
  $name = "test user $i";
  $pass = md5("test PassW0rd $i !(.)");
  $mail = "test$i@example.com";
  $now = mktime(0, 0, 0, 1, $i + 1, 2010);
  db_query("INSERT INTO {users} (name, pass, mail, status, created, access) VALUES ('%s', '%s', '%s', %d, %d, %d)", $name, $pass, $mail, 1, $now, $now);
}
```

Creds generated with that particular php part
```
test user 0
        4dd188028f74622e61048f6683208c2f
        test0@example.com
test user 1
        388ee5249286bf5eed0dae9205743969
        test1@example.com
test user 2
        ff8a825362e1e06dca5c13c60fe407c9
        test2@example.com
test user 3
        9d4bd7b0570cb513dc7c6ea8de15003a
        test3@example.com
test user 4
        7903c9dd9d71bcd70e3a18141711cb42
        test4@example.com
test user 5
        8eb7221204ea80db4e66247b4c748071
        test5@example.com
```

![php_user_generation_script](/_storage/_img/_pentest_labs/_htb/ready/php_user_generation_script.png)  

So... with all the information and also this hint here we can try to find vulnerability and exploit it maybe...  
![update_asap](/_storage/_img/_pentest_labs/_htb/ready/update_asap.png)  

Searchsploit suggests that this version of gitlab is vulnerable to remote code execution  
![searchsploit](/_storage/_img/_pentest_labs/_htb/ready/searchsploit.png)  
 
I am not sure if creds harvested will be useful at all but we will see...  

## Exploitation

Lets try to exploit it now.  

### Exploiting RCE vulnerability  

Gitlab 11.4.7 is actually vulnerable to two vulnerabilities SSRF and CRLF which in combination result in RCE but...  
Exploit from searchsploit didn't work straightaway...   

After messing around I found that some of the exploits found in searchsploit and on github do not really work that well and the only one that really worked was `https://raw.githubusercontent.com/dotPY-hax/gitlab_RCE/main/gitlab_rce.py` or just [click here](/_storage/download/_pentest_labs/_htb/ready/gitlab_rce.py)  

after a bit of trial and error I got shell as `git` user  
![gitlab_rce](/_storage/_img/_pentest_labs/_htb/ready/gitlab_rce.png)  
![reverse_shell_as_git](/_storage/_img/_pentest_labs/_htb/ready/reverse_shell_as_git.png)  

## Privilege Escalation  

Since we at least have gained a reverse shell, now we can move on to privilege escalation.  

LinPeas in our service  
![linpeas](/_storage/_img/_pentest_labs/_htb/ready/linpeas.png)  
after messing around a bit, checking linpeas output and surfing through files manually, I discovered there was a backup folder too containing gitlab.rb script containing a password which is useful for logging in as root...  
![password_found](/_storage/_img/_pentest_labs/_htb/ready/password_found.png)  

Now we can just `su -` and we are `root`  
![root](/_storage/_img/_pentest_labs/_htb/ready/root.png)  

