[**< back**](/README.md)

# HTB - Tabby

![help_banner](/_storage/_img/_pentest_labs/_htb/tabby/tabby.png)  
**Machine**: Tabby  
**Author**: Nika Kharebava  

## Information Gathering  
### NMap  
Initial enumeration using Nmap :mag:  
`nmap -sV -sC -T5 -Pn 10.129.226.92 -oA tabby`  

![initial_nmap_scan](/_storage/_img/_pentest_labs/_htb/tabby/initial_nmap_scan.png)  

So it is running two web services, on port 80 and on port 8080  

**MegaHosting** on Port 80
![mega_hosting](/_storage/_img/_pentest_labs/_htb/tabby/mega_hosting.png)

After surfing the web a bit I discovered an endpoint... `news.php?file=statement`, at a glance I thought it might be sql injectable, then I realized the parameter said `file`, so why not to try path traversal, which worked fine.

![path_traversal_discovered](/_storage/_img/_pentest_labs/_htb/tabby/path_traversal_discovered.png)

Which means we can fetch other configuration files of tocmat to upload a shell there and gain access to it... maybe... 

![tomcat_xml_warning](/_storage/_img/_pentest_labs/_htb/tabby/tomcat_xml_warning.png)  

The only thing left is to find the actual xml configuration file...

After googling a bit and little trial and error this is what I've got `http://megahosting.htb/news.php?file=../../../../../../../../usr/share/tomcat9/etc/tomcat-users.xml`  
![tomcat_creds_found](/_storage/_img/_pentest_labs/_htb/tabby/tomcat_creds_found.png)  

I was unable to login in `manager` page but I could login into the `host-manager`  
![host_manager_page](/_storage/_img/_pentest_labs/_htb/tabby/host_manager_page.png)

I tried setting up a smbserver to server payload to tomcat but it was not very successful...  
![smb_server_test](/_storage/_img/_pentest_labs/_htb/tabby/smb_server_test.png)  
![tomcat_failed](/_storage/_img/_pentest_labs/_htb/tabby/tomcat_failed.png)  
So... probably there should be another way of exploiting it after all.  

## Exploitation

### Exploiting file upload vulnerability  

helpdeskz is vulnerable to authenticated file upload, we can upload a php file, which results in an error code saying file type not allowed, but the file is still there and the exploit is exactly for the purpose of finding the exact path after uploading the shell file...  
![uploading_shell](/_storage/_img/_pentest_labs/_htb/help/uploading_shell.png)  

Next we run the python script from searchsploit, allowing us to find the exact path after upload...  
![upload_python_exploit_search](/_storage/_img/_pentest_labs/_htb/help/upload_python_exploit_search.png)  

And now we have the shell as `help` user  
 ![shell_as_help_user](/_storage/_img/_pentest_labs/_htb/help/shell_as_help.png)  
 ![shell_as_help_user](/_storage/_img/_pentest_labs/_htb/help/shell.png)  

## Privilege Escalation  

Since we have only gained access to `help` user, we have to somehow gain root privileges to fully compromise the machine  

Lets first check the exact system version  
![uname_a](/_storage/_img/_pentest_labs/_htb/help/uname_a.png)  

After a bit of searching... :mag:  
![searchsploit](/_storage/_img/_pentest_labs/_htb/help/searchsploit_privilege_escalation.png)  
I'm using this one right here...  
`Linux Kernel < 4.4.0-116 (Ubuntu 16.04.4) - Local Privilege Escalation           | linux/local/44298.c`

Delivering and compiling exploit :microbe:  
![delivery_and_compilation](/_storage/_img/_pentest_labs/_htb/help/delivery_and_compilation.png)  

And that's it, we are root :penguin:  
![escalated](/_storage/_img/_pentest_labs/_htb/help/escalated.png)  

![mission_accomplished](/_storage/_img/_pentest_labs/_htb/help/mission_accomplished.gif)